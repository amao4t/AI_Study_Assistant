<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Study Assistant - Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <header>
        <h1>AI-Powered Study Assistant</h1>
        <nav>
            <div id="hamburger-menu" onclick="toggleMenu()">
                <i class="fas fa-bars"></i>
            </div>
            <ul id="navbar-links">
                <li><a href="#home" onclick="showSection('home')">Home</a></li>
                <li><a href="#features-upload" onclick="handleStartButtonClick()">Features & Upload</a></li>
                {% if 'username' in session %}
                    <li><a href="{{ url_for('logout') }}">Logout</a></li>
                {% else %}
                    <li><a href="#login-signup" onclick="showSection('login-signup')">Login / Sign Up</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>

    <!-- Flash Messages -->
    <section id="flash-messages" style="background: transparent;">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div id="flash-container" style="background: transparent;">
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
        {% endif %}
        {% endwith %}
    </section>

    <!-- Home and How It Works combined -->
    <section id="home" class="content-section" style="background: transparent;">
        <h2>Welcome to Your Personal AI Study Assistant</h2>
        <p>Enhance your learning experience with AI-generated summaries, quizzes, and personalized study guides.</p>
        <h2>How It Works</h2>
        <div class="step">
            <h3>Step 1: Upload Your Materials</h3>
            <p>Simply drag and drop or upload your study materials in PDF, DOCX, or TXT format.</p>
        </div>
        <div class="step">
            <h3>Step 2: AI Analyzes the Content</h3>
            <p>Our advanced AI processes the materials to create summaries and questions tailored for you.</p>
        </div>
        <div class="step">
            <h3>Step 3: Learn and Practice</h3>
            <p>Receive personalized study guides, summaries, and quizzes to make learning easy and efficient.</p>
        </div>
        <a href="#features-upload" class="link-button" onclick="handleStartButtonClick()">Get Started</a>
    </section>

    <!-- Features and Upload combined -->
    <section id="features-upload" class="content-section" style="background: rgba(255, 255, 255, 0.8); padding: 20px; border-radius: 10px; display:none;">
        <h2>Features</h2>
        <div class="feature">
            <h3><i class="fas fa-book"></i> AI Summaries</h3>
            <p>Upload your study materials, and our AI will generate a concise summary to help you grasp key points.</p>
        </div>
        <div class="feature">
            <h3><i class="fas fa-question-circle"></i> Practice Questions</h3>
            <p>Generate practice questions based on your study content to test your understanding effectively.</p>
        </div>
        <div class="feature">
            <h3><i class="fas fa-user-graduate"></i> Personalized Tutoring</h3>
            <p>Ask specific questions, and the AI will provide answers, just like a tutor would do.</p>
        </div>
        <h2><i class="fas fa-upload"></i> Upload Your Study Materials</h2>
        <form id="upload-form" method="post" enctype="multipart/form-data" action="{{ url_for('upload') }}">
            {{ upload_form.hidden_tag() }} <!-- CSRF token will be generated here -->
            <label for="file-input">Choose your study material:</label>
            {{ upload_form.studyMaterial() }}
            
            <label for="summary-type">Choose Summary Length:</label>
            {{ upload_form.summary_type() }}

            <button type="submit">Upload</button>
        </form>
        <div id="loader" style="display:none; margin-top: 20px;">Processing your document...</div>
        <div id="summary-result" style="display:none; margin-top: 20px;">
            <h3>Summary</h3>
            <p id="summary-content"></p>
        </div>
    </section>

    <!-- Login/Sign Up combined -->
    <section id="login-signup" class="content-section" style="background: rgba(255, 255, 255, 0.8); padding: 20px; border-radius: 10px; display:none;">
        <h2>Login or Sign Up</h2>
        <form id="login-form" method="post" action="{{ url_for('login') }}">
            {{ login_form.hidden_tag() }}
            <label for="username">Username:</label>
            {{ login_form.username() }}
            <label for="password">Password:</label>
            {{ login_form.password() }}
            <div>
                {{ login_form.remember_me() }}
                <label for="remember_me">Remember Me</label>
            </div>
            <button type="submit">Login</button>
        </form>
        <p>Don't have an account? <a href="#" onclick="toggleSignUp()">Sign Up Here</a></p>
        
        <form id="signup-form" method="post" action="{{ url_for('signup') }}" style="display:none;">
            {{ signup_form.hidden_tag() }}
            <label for="new-username">Username:</label>
            {{ signup_form.new_username() }}
            <label for="new-password">Password:</label>
            {{ signup_form.new_password() }}
            <label for="confirm-password">Confirm Password:</label>
            {{ signup_form.confirm_password() }}
            <button type="submit">Sign Up</button>
        </form>
    </section>

    <footer>
        <p>&copy; 2024 AI-Powered Study Assistant. All rights reserved. | Contact us at <a href="mailto:support@aistudyassistant.com">support@aistudyassistant.com</a></p>
    </footer>

    <script>
        function toggleMenu() {
            const navbarLinks = document.getElementById('navbar-links');
            navbarLinks.classList.toggle('show');
        }

        function showSection(sectionId) {
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            const selectedSection = document.getElementById(sectionId);
            if (selectedSection) {
                selectedSection.style.display = 'block';
            }
        }

        function handleStartButtonClick() {
            const loggedIn = "{{ 'username' in session }}"; // Real authentication logic from the server
            if (loggedIn === "True") {
                showSection('features-upload');
            } else {
                showSection('login-signup');
            }
        }

        function toggleSignUp() {
            const signupForm = document.getElementById('signup-form');
            signupForm.style.display = signupForm.style.display === 'none' ? 'block' : 'none';
        }

        document.addEventListener("DOMContentLoaded", function () {
            setTimeout(function() {
                const flashMessages = document.querySelectorAll('.alert-dismissible');
                flashMessages.forEach(message => {
                    if (message.classList.contains('show')) {
                        message.classList.remove('show');
                        message.classList.add('fade-out');
                    }
                });
            }, 5000); // Tự động đóng sau 5 giây

            const uploadForm = document.getElementById('upload-form');
            const loader = document.getElementById('loader');
            const summaryResult = document.getElementById('summary-result');
            const summaryContent = document.getElementById('summary-content');

            if (uploadForm) {
                uploadForm.addEventListener('submit', function (event) {
                    event.preventDefault();
                    const formData = new FormData(uploadForm);

                    loader.style.display = 'block';
                    summaryResult.style.display = 'none';

                    fetch(uploadForm.action, {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        loader.style.display = 'none';
                        if (data.error) {
                            const flashContainer = document.getElementById('flash-container');
                            flashContainer.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                        } else {
                            summaryContent.textContent = data.summary;
                            summaryResult.style.display = 'block';
                        }
                    })
                    .catch(error => {
                        loader.style.display = 'none';
                        alert('An error occurred while processing your document. Please try again.');
                    });
                });
            }
        });
    </script>
</body>
</html>